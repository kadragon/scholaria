---
id: AG-WORKFLOW-ALEMBIC-001
version: 1.0.0
scope: global
status: active
supersedes: []
depends: [AG-POLICY-DEV-GUARDRAILS-001]
last-updated: 2025-10-11
owner: team-admin
---
# Alembic Migration Flow

## Authoring
- Generate revisions with `uv run alembic revision -m "<summary>"`.
- Prefer sequential numeric prefixes (`0001`, `0002`, â€¦) for new files; legacy hashed IDs remain but should reference the correct `down_revision`.
- Review autogenerated diffs; prefer explicit column operations over implicit detection when models change.

## Validation
- Extend `backend/tests/test_alembic_migrations.py` to cover upgrade, downgrade, and idempotency.
- Run migrations inside Docker with `docker compose exec backend alembic upgrade head` before merging.

## Deployment
- Production command: `docker compose -f docker-compose.prod.yml exec backend alembic upgrade head`.
- Document migration intent and any manual data steps in `.spec/` before rollout.
