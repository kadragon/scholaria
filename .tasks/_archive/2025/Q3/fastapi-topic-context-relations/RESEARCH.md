Goal | Scope | Related Files/Flows | Hypotheses | Evidence | Assumptions/Open Qs | Sub-agent Findings | Risks | Next
--- | --- | --- | --- | --- | --- | --- | --- | ---
Align FastAPI SQLAlchemy layer with Django's Topicâ†”Context ManyToMany so read endpoints can surface relationships. | Phase 1 scope: SQLAlchemy models, Pydantic schemas, read-only routers, FastAPI tests. | `api/models/topic.py`, `api/models/context.py`, `api/schemas/topic.py`, `api/schemas/context.py`, `api/routers/topics.py`, `api/routers/contexts.py`, `api/tests/`, `rag/models.py`, `rag/migrations/0003_topic_contexts.py`. | 1) Django creates implicit join table `rag_topic_contexts` (`topic_id`, `context_id`). 2) SQLAlchemy can mirror via `Table` + `relationship(..., secondary=...)`. 3) Existing Pydantic schemas must expose related resource IDs or nested data for parity. | - `rag/models.Topic.contexts` ManyToMany defined.<br>- Django reports join table `rag_topic_contexts` with columns `id`, `topic_id`, `context_id` (via uv shell).<br>- FastAPI Topic model lacks relationships; contexts router returns contexts without topics.<br>- PHASE1 summary lists ManyToMany mapping as incomplete. | - Need to verify join table column names & PK (likely `id`, `topic_id`, `context_id`).<br>- Determine preferred API shape (list of IDs vs nested contexts).<br>- Confirm tests should run against shared DB fixture. | None. | - ORM mapping mismatch could break queries at runtime.<br>- Join queries may be slow without eager loading.<br>- Tests may need DB overrides similar to topics tests. | Inspect DB schema/migration for join table fields; design TDD test for topic-context linkage; update models/schemas/routers accordingly.
